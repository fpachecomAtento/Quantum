var mongoose = require('mongoose');
var companys = mongoose.model('companys'),
	apps = mongoose.model('apps'),
	queues = mongoose.model('queues');

module.exports = function(req, res){
	var constructApp = {
		launch : req.params.token,
		app : {},
		queues : {}
	};

	companys.findById(req.params.token,function(err, resToGet){
		if(resToGet == null)
			return res.status(200).jsonp({error:204,message : 'no found result'});

		constructApp.app = resToGet;
		getApp();
	});

	function getApp(){
		apps.find({
			company : constructApp.launch
		},function(err, resApp){
			constructApp.app = resApp;
			getQueues();
			
		});
	}

	function getQueues(){
		queues.find({
			company : constructApp.launch
		},function(err, resQueues){
			constructApp.queues = resQueues;
			res.status(200).jsonp(constructApp);
		});
	}

	
}